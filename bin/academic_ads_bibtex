#!/usr/bin/env python

import argparse
from pathlib import Path

from academic_ads_bibtex import converter, __file__

if __name__ == '__main__':

    parser = argparse.ArgumentParser(
        description='Main command-line driver For Academic ADS BibTeX.')
    parser.add_argument('-f', '--filename', required=True,
                        help='Full path of BibTeX file (.bbl)')
    parser.add_argument('-d', '--db_filename',
                        help='Full path of input journal database (optional)')
    parser.add_argument('-o', '--out_filename',
                        help='Full path of output BibTeX file (optional)')
    args = parser.parse_args()
    vargs = vars(args)

    root_dir = Path(__file__).parent.parent

    p = Path(vargs['filename'])
    vargs['filename'] = p

    if vargs['db_filename'] is None:
        vargs['db_filename'] = root_dir / "bibtex_journals.db"
    else:
        vargs['db_filename'] = Path(vargs['db_filename'])

    if vargs['out_filename'] is None:
        outfile = p.parent / f"{p.stem}_revised{p.suffix}"
        vargs['out_filename'] = outfile
    else:
        vargs['out_filename'] = Path(vargs['out_filename'])

    # Import file
    c = converter.Convert(vargs['filename'],
                          vargs['db_filename'],
                          out_filename=vargs['out_filename'])

    c.write_file()
